$(document).ready(function(){if(!String.prototype.format){String.prototype.format=function(){var o=this.toString();if(arguments.length){var n=typeof arguments[0];var m;var l=("string"===n||"number"===n)?Array.prototype.slice.call(arguments):arguments[0];for(m in l){o=o.replace(new RegExp("\\{\\{"+m+"\\}\\}","gi"),l[m]);o=o.replace(new RegExp("\\{\\{ "+m+" \\}\\}","gi"),l[m])}}return o}}var a=function(l){return $(l)};var c=function(n){var m;if(n){var l=n.split("_",1).shift();if(l==="checkbox"){m=$("input[name*='"+n+"[]']")}else{if(l==="radio"){m=$("input[name*='"+n+"']")}else{if(l==="matrix"){m=$("#"+n).find("input")}else{m=$("#"+n)}}}}return m};var b=function(o){var r;var n;if(o instanceof Array){var q;var p=[];for(q=0;q<o.length;q++){var l;n=o[q].split("_",1).shift();if(n==="radio"){l="input[name='"+o[q]+"']:checked"}else{if(n==="checkbox"){l="input[name*='"+o[q]+"[]']:checked"}else{if(n==="matrix"){var m=$("#"+o[q]);if(m.attr("data-matrix-type")==="radio"){l="#"+o[q]+" input[type='radio']:checked"}else{if(m.attr("data-matrix-type")==="checkbox"){l="#"+o[q]+" input[type='checkbox']:checked"}else{l="#"+o[q]+" :input"}}}else{l="#"+o[q]}}}p.push(l)}r=$(p.join(", "))}else{n=o.split("_",1).shift();if(n==="radio"){r=$("input[name='"+o+"']:checked")}else{if(n==="checkbox"){r=$("input[name*='"+o+"[]']:checked")}else{if(n==="matrix"){var m=$("#"+o);if(m.attr("data-matrix-type")==="radio"){r=m.find("input[type='radio']:checked")}else{if(m.attr("data-matrix-type")==="checkbox"){r=m.find("input[type='checkbox']:checked")}else{r=m.find(":input")}}}else{r=$("#"+o)}}}}return r};var d=function(l){return(l.find("original")==="field")?b(l.find("original","originalField")):a(l.find("original","originalElement"))};var h=function(n,l){var o=(n.find("target")==="field")?c(n.find("target","targetField")):a(n.find("target","targetElement")),m=(l.is(":input"))?l.val():l.html();if(l.length>1){m=l.map(function(){return $(this).is(":input")?$(this).val():$(this).text()}).get().filter(Boolean).join(", ")}if(n.find("original")==="value"){m=n.find("original","originalValue")}if(o.length>1){if(o.is(":radio, :checkbox")){if(l.length>1){$(":checkbox[name*='"+o.attr("name")+"']").prop("checked",false);$.each(l,function(){if($(this).is(":checkbox")){m=$(this).val();$(":checkbox[name*='"+o.attr("name")+"'][value*='"+m+"']").prop("checked",true)}})}else{$(":input[name*='"+o.attr("name")+"']").prop("checked",false);$(":input[name*='"+o.attr("name")+"'][value*='"+m+"']").prop("checked",true)}}else{if(o.is(":input")){o.val(m)}else{o.text(m)}}}else{if(o.is(":radio, :checkbox")){$(":input[name*='"+o.attr("name")+"']").prop("checked",false);$(":input[name*='"+o.attr("name")+"'][value*='"+m+"']").prop("checked",true)}else{if(o.is(":input")){o.val(m)}else{o.html(m)}}}};var f=function(n,l){var o=(n.find("target")==="field")?c(n.find("target","targetField")):a(n.find("target","targetElement"));var p={};l.map(function(r){p[r]=$(this).is(":input")?$(this).val():$(this).text();var u=$(this).attr("id");if($(this).is(":radio")){u=$(this).attr("name")}else{if($(this).is(":checkbox")){u=$(this).attr("name").replace("[]","")}}if(u.length>1){p[u]=$(this).is(":input")?$(this).val():$(this).text();if($(this).is(":checkbox")){p[u]=$(":input[name*='"+$(this).attr("name")+"']:checked").map(function(){return $(this).is(":input")?$(this).val():$(this).text()}).get().filter(Boolean).join(", ")}}var q=$(this).data("alias");var t=$(this).data("matrix-id");if(q&&q.length>1){if(t&&t.length>1){var s=q.split("_");if(s.length>1){q=s[0]+"_"+s[1]}}p[q]=p[u]}});var m=n.find("format").format(p);if(o.is(":radio, :checkbox")){}else{if(o.is(":input")){o.val(m)}else{o.html(m)}}};var k=function(m,l){if(m.find("target")==="field"){c(m.find("target","targetField")).val(l)}else{if(m.find("target")==="element"){var n=a(m.find("target","targetElement"));if(n.length>1){$.each(n,function(){if($(this).is(":input")){$(this).val(l)}else{$(this).text(l)}})}else{if(n.is(":input")){n.val(l)}else{n.text(l)}}}}};var e=function(o){var m=o.find("operator");var n=o.find("operands");var l=NaN;if(!!m){if($.isArray(n)){$.each(n,function(r,p){var q=b(p);if(q.length>1){$.each(q,function(v,t){var u=parseFloat($(t).val());if(!isNaN(u)){if(isNaN(l)){l=u}else{switch(m){case"+":l+=u;break;case"-":l-=u;break;case"*":l*=u;break;case"/":l/=u;break;case"%":l%=u;break}}}})}else{if(q.length===1){var s=parseFloat(q.val());if(!isNaN(s)){if(isNaN(l)){l=s}else{switch(m){case"+":l+=s;break;case"-":l-=s;break;case"*":l*=s;break;case"/":l/=s;break;case"%":l%=s;break}}}}}})}if(isNaN(l)){l=0}k(o,l)}return 0};var g=function(m){var p=m.find("formula"),o="",n="";var l=/\{\{([a-zA-Z_0-9]+)\}\}/gm;if(l.test(p)){p=p.replace(l,"{{#$1}}")}if(m.find("target")==="field"){n=m.find("target","targetField");if(n.length>0&&p.length){o="{{#"+n+"}} = "+p}}else{if(m.find("target")==="element"){n=m.find("target","targetElement");if(n.length>0&&p.length){o="{{"+n+"}} = "+p}}}if(o.length>0){$("form").evaluate(o)}};var j=function(){var m={},l=$("body"),o=l.outerHeight(true);$.each(options.fieldIds,function(r,u){var t=$("#"+u);var q=t.attr("name");var s=t.attr("type")||t.get(0).tagName.toLowerCase();if(s==="checkbox"){m[u]=t.is(":checked")}else{if(s==="radio"){m[q]=$("input[name='"+q+"']:checked").val()}else{if(s==="button"){m[u]=t.data("clicked")}else{if(s==="select"){m[u]=t.val()}else{m[u]=t.val()}}}}});var p={toShow:function(q){if(q.find("target")==="field"){var r=c(q.find("target","targetField"));if(!r.is(":visible")){r.trigger("ef.show")}if(r.is(":radio, :checkbox")){r.css("display","inline-block")}else{r.show()}r.parent().closest("div.form-group").show();r.trigger("ef.shown")}else{if(q.find("target")==="element"){var s=a(q.find("target","targetElement"));if(!s.is(":visible")){s.trigger("ef.show")}s.show().trigger("ef.shown")}}},toHide:function(q){if(q.find("target")==="field"){var r=c(q.find("target","targetField"));if(r.is(":visible")){r.trigger("ef.hide")}r.hide();r.parent().closest("div.form-group").hide();r.trigger("ef.hidden")}else{if(q.find("target")==="element"){var s=a(q.find("target","targetElement"));if(s.is(":visible")){s.trigger("ef.hide")}s.hide().trigger("ef.hidden")}}},toEnable:function(q){if(q.find("target")==="field"){var r=c(q.find("target","targetField")).prop("disabled",false)}else{if(q.find("target")==="element"){a(q.find("target","targetElement")).prop("disabled",false)}}},toDisable:function(q){if(q.find("target")==="field"){var r=c(q.find("target","targetField")).prop("disabled",true)}else{if(q.find("target")==="element"){a(q.find("target","targetElement")).prop("disabled",true)}}},performArithmeticOperations:function(q){e(q)},evaluateMathFormula:function(q){g(q)},resetResult:function(q){if(options.submitted){return false}k(q,0)},copy:function(r){var q=d(r);h(r,q)},skip:function(s,q){var r=$.grep(options.skips,function(t){return t.id===q});if(r.length===0){options.skips.push({id:q,from:null,to:parseInt(s.find("step"))})}},resetSkip:function(r,q){options.skips=$.grep(options.skips,function(s){return s.id!==q})},formatNumber:function(s){if(options.twoLetterLanguageCode){numeral.locale(options.twoLetterLanguageCode)}if(s.find("target")==="field"){var t=c(s.find("target","targetField"));if(t){var r=numeral(parseFloat(t.val())).format(s.find("format"));t.val(r)}}else{if(s.find("target")==="element"){var q=a(s.find("target","targetElement"));if(q){var u=numeral(parseFloat(q.text())).format(s.find("format"));q.text(u)}}}},formatText:function(r){var q=d(r);f(r,q)},form:function(r){var q=r.find("action");if(q==="submit"){console.trace("SUBMIT");i.submit()}else{if(q==="reset"){i.get(0).reset()}else{if(q==="nextStep"){nextStep()}else{if(q==="previousStep"){previousStep()}}}}}};$.each(options.rules,function(q,t){var r=new RuleEngine({conditions:JSON.parse(t.conditions),actions:JSON.parse(t.actions)});var s=t.opposite?{toShow:"toHide",toHide:"toShow",toEnable:"toDisable",toDisable:"toEnable",performArithmeticOperations:"resetResult",skip:"resetSkip"}:{};r.run(m,p,s)});var n=l.outerHeight(true);if(o!==n){Utils.postMessage({height:n})}};var i=$("form");i.find(":input:not(select)").on("input click",function(){j()});i.find("select").on("change",function(){j()});i.on("view success",function(){j()});i.find(":button").mousedown(function(){$(this).data("clicked",true)})});