$(document).ready(function(){var o="#475e98";var n="#9B59B6";var m="#F8B700";var k="#78CC00";var j="#7B71C5";var g="#56B2EA";var f="#E064CD";var a=[o,n,m,k,j,g,f];dc.config.defaultColors(a);var p=$("#overview-chart").length?dc.compositeChart("#overview-chart"):null;var c=$("#year-chart").length?dc.pieChart("#year-chart"):null;var d=$("#month-chart").length?dc.barChart("#month-chart"):null;var l=$("#day-of-week-chart").length?dc.rowChart("#day-of-week-chart"):null;var i=$("#conversion-time-chart").length?dc.barChart("#conversion-time-chart"):null;var b=$("#conversion-time-line-chart").length?dc.compositeChart("#conversion-time-line-chart"):null;var h=$("#abandonment-chart").length?dc.pieChart("#abandonment-chart"):null;var e=$("#abandonment-time-chart").length?dc.compositeChart("#abandonment-time-chart"):null;d3.csv(options.endPoint).then(function(U){var W=d3.timeParse("%Y-%m-%d");var C=d3.timeFormat("%Y-%m-%d");var Q=d3.timeFormat("%M:%S");U.forEach(function(X){X.users=+X.users;X.fills=+X.fills;X.conversions=+X.conversions;X.conversionTime=+X.conversionTime;X.abandonments=X.fills-X.conversions;X.abandonmentRate=Math.round((X.abandonments)/X.users*100);X.date=W(X.day);X.year=X.date.getFullYear()});function E(X){return function(Z,Y){X.forEach(function(aa){Z[aa]+=Y[aa]});return Z}}function O(X){return function(Z,Y){X.forEach(function(aa){Z[aa]-=Y[aa]});return Z}}function q(X){return function(){var Y={};X.forEach(function(Z){Y[Z]=0});return Y}}var I=["users","fills","conversions"];var t=crossfilter(U);var r=t.groupAll();var F=t.dimension(function(X){return X.date});var V=F.group().reduceSum(function(X){return X.users});var R=F.group().reduceSum(function(X){return X.fills});var u=F.group().reduceSum(function(X){return X.conversions});var A=t.dimension(function(X){return X.year});var J=A.group().reduce(E(I),O(I),q(I));var z=options.i18n.months;var L=t.dimension(function(Y){var X=Y.date.getMonth();return z[X]});var v=L.group().reduce(E(I),O(I),q(I));var K=t.dimension(function(Z){var X=Z.date.getDay();var Y=options.i18n.days;return X+"."+Y[X]});var y=K.group().reduce(E(I),O(I),q(I));var s=t.dimension(function(Y){var X;if(Y.conversionTime<120){X="0 - 2"}else{if(Y.conversionTime<240){X="2 - 4"}else{if(Y.conversionTime<360){X="4 - 6"}else{if(Y.conversionTime<600){X="6 - 10"}else{X="+ 10"}}}}return X});var D=s.group().reduceSum(function(X){return X.conversions});var G=F.group().reduceSum(function(X){return X.conversionTime});function P(Z,Y){var X=Z.groupAll().reduce(function(ab,aa){Y.forEach(function(ac){ab[ac]+=aa[ac]});return ab},function(ab,aa){Y.forEach(function(ac){ab[ac]-=aa[ac]});return ab},function(){var aa={};Y.forEach(function(ab){aa[ab]=0});return aa});return{all:function(){return d3.map(X.value()).entries()}}}var T=t.dimension(function(X){return X.a});var H=P(T,["conversions","abandonments"]);var M=F.group().reduceSum(function(X){return X.abandonmentRate});function N(){var ad=F.top(Infinity);var aa=0,ab=0,ac=0;$.each(ad,function(ae,af){$.each(af,function(ag,ah){if(ag==="users"){aa+=ah}else{if(ag==="fills"){ab+=ah}else{if(ag==="conversions"){ac+=ah}}}})});var X=isNaN(Math.round(ab/aa*100))?0:Math.round(ab/aa*100),Z=isNaN(Math.round(ac/ab*100))?0:Math.round(ac/ab*100),Y=isNaN(Math.round(ac/aa*100))?0:Math.round(ac/aa*100);$("#users-number").text(aa);$("#fills-number").text(ab);$("#conversions-number").text(ac);$("#fills-rate").text(X);$("#completion-rate").text(Z);$("#conversion-rate").text(Y)}if($(".data-count").length){dc.dataCount(".data-count").crossfilter(t).groupAll(r)}var x=(typeof F.bottom(1)[0]!="undefined")?F.bottom(1)[0].date:0;var B=(typeof F.top(1)[0]!="undefined")?F.top(1)[0].date:0;if($("#overview").length){p.width($("#overview").width()).height(280).x(d3.scaleTime().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(1).legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).shareTitle(false).on("preRender",N).brushOn(false).compose([dc.lineChart(p).dimension(F).colors(o).curve(d3.curveCardinal.tension(0.5)).title(function(Y){var X=C(Y.key);return" "+X+": "+Y.value+" "+options.i18n.users}).renderArea(false).group(V,options.i18n.users),dc.lineChart(p).dimension(F).colors(n).curve(d3.curveCardinal.tension(0.5)).title(function(Y){var X=C(Y.key);return" "+X+": "+Y.value+" "+options.i18n.starters}).renderArea(false).dashStyle([15,10]).group(R,options.i18n.starters),dc.lineChart(p).dimension(F).colors(m).curve(d3.curveCardinal.tension(0.5)).title(function(Y){var X=C(Y.key);return" "+X+": "+Y.value+" "+options.i18n.conversions}).renderArea(true).group(u,options.i18n.conversions)]).render()}if($("#year").length){var w=$("#year").width();c.width(w).height(230).dimension(A).group(J).valueAccessor(function(X){return X.value.conversions}).innerRadius(75).renderLabel(false).renderTitle(true).title(function(Y){var X=Y.key+" \n";X+=Y.value.users+" "+options.i18n.users+" \n";X+=Y.value.fills+" "+options.i18n.starters+" \n";X+=Y.value.conversions+" "+options.i18n.conversions;return X}).legend(dc.legend().x(Math.round((w*50/100)-18)).y(95).itemHeight(13).gap(5)).on("filtered",N)}if($("#month").length){d.width($("#month").width()).height(250).dimension(L).group(v).valueAccessor(function(X){return X.value.conversions}).title(function(Y){var X=Y.key+" \n";X+=Y.value.users+" "+options.i18n.users+" \n";X+=Y.value.fills+" "+options.i18n.starters+" \n";X+=Y.value.conversions+" "+options.i18n.conversions;return X}).brushOn(false).on("filtered",N).x(d3.scaleBand().domain(z)).xUnits(dc.units.ordinal).elasticY(true)}if($("#week").length){l.width($("#week").width()).height(240).margins({top:0,left:10,right:10,bottom:20}).dimension(K).group(y).valueAccessor(function(X){return X.value.conversions}).label(function(X){return X.key.split(".")[1]}).title(function(Y){var X=Y.key.split(".")[1]+" \n";X+=Y.value.users+" "+options.i18n.users+" \n";X+=Y.value.fills+" "+options.i18n.starters+" \n";X+=Y.value.conversions+" "+options.i18n.conversions;return X}).on("filtered",N).elasticX(true).xAxis().ticks(4)}if($("#conversion-time").length){i.width($("#conversion-time").width()).height(253).group(D).dimension(s).brushOn(false).on("filtered",N).x(d3.scaleBand().domain(["0 - 2","2 - 4","4 - 6","6 - 10","+ 10"])).xAxisLabel(options.i18n.minutes).xUnits(dc.units.ordinal).elasticY(true)}if($("#conversion-time-line").length){b.width($("#conversion-time-line").width()).height(240).x(d3.scaleTime().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(50).yAxisLabel("").legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).title(function(Y){var X=(Y.key.getMonth()+1)+"/"+Y.key.getDate()+"/"+Y.key.getFullYear();return" "+X+" \n "+Q(new Date(2015,0,1,0,0,Y.value))}).on("preRender",N).brushOn(false).compose([dc.lineChart(b).dimension(F).colors(n).renderArea(true).group(G,options.i18n.medianPerDay)]).render();b.yAxis().tickFormat(function(X){return Q(new Date(2015,0,1,0,0,X))})}if($("#abandonment").length){var S=$("#abandonment").width();h.width(S).height(230).dimension(T).group(H).innerRadius(75).renderLabel(false).renderTitle(true).title(function(X){return X.value+" "+X.key}).legend(dc.legend().x(Math.round((S*50/100)-43)).y(95).itemHeight(13).gap(5));h.filter=function(){}}if($("#abandonment-time").length){e.width($("#abandonment-time").width()).height(240).x(d3.scaleTime().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(50).legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).title(function(Y){var X=(Y.key.getMonth()+1)+"/"+Y.key.getDate()+"/"+Y.key.getFullYear();return X+"\n"+Y.value+"%"}).on("preRender",N).brushOn(false).compose([dc.lineChart(e).dimension(F).colors(o).renderArea(true).group(M,options.i18n.medianPerDay)]).render();e.yAxis().tickFormat(function(X){return X+"%"})}dc.renderAll();$("#reset-all").on("click",function(X){X.preventDefault();dc.filterAll(null);dc.renderAll()})})});