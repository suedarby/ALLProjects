$(document).ready(function(){window.formEl=$(options.name);var v=$("#progress");var h=$("#bar");var c=$("#percent");var s=$("fieldset");var g,z,e;var A=false;var t=0;var o=null;var l=null;var D=null;formEl.attr("role","form");$("<input>").attr({type:"hidden",id:"_csrf",name:"_csrf",value:options._csrf}).appendTo(formEl);if(options.text_direction==="rtl"){formEl.find(":input").attr("dir","rtl")}if(options.autocomplete){formEl.attr("autocomplete","on")}else{formEl.attr("autocomplete","off")}if(options.novalidate){formEl.attr("novalidate","novalidate")}else{if(formEl.attr("novalidate")!=="novalidate"){formEl.removeAttr("novalidate")}}if(options.resume){formEl.resume({key:"form_app_"+options.id})}if(options.fingerprint){Fingerprint2.get(function(E){o=Fingerprint2.x64hash128(E.map(function(F){return F.value}).join(),31)})}if(options.geolocation&&navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(function(E){l=E.coords.latitude;D=E.coords.longitude})}if(options.initialStep){var p=parseInt(options.initialStep)-1;if(p>0&&p<s.length){g=formEl.find("fieldset:visible");z=s.eq(p);if(z.is("fieldset")){g.hide();z.show();e=g}var w=$(".steps");if(w.length>0){w.find(".step").eq(s.index(g)).removeClass("current");w.find(".step").eq(s.index(z)).prevAll().addClass("success");w.find(".step").eq(s.index(z)).addClass("current")}else{var m=$(".progress").first();var u=m.find(".progress-bar");var b=u.find(".percent");var C=u.find(".title");var B=u.data("titles");if(typeof B!=="undefined"){B=B.split(",");var d=B[s.index(z)];C.html(d)}var f=Math.round(100/s.length*s.index(z))+"%";b.text(f);u.width(f)}}}setInterval(r,10);var y;function r(){var E=Math.max(window.document.body.scrollHeight,window.document.body.offsetHeight,window.document.documentElement.offsetHeight);if(y!==E){Utils.postMessage({height:E});y=E}}window.nextStep=function(){var E=false;g=formEl.find("fieldset:visible");z=g.next();if(options.skips.length>0){for(var F=0;F<options.skips.length;F++){if(s.index(g)<options.skips[F].to){var G=s.eq(options.skips[F].to);if(s.index(g)<s.index(G)){if(options.skips[F].from==null||options.skips[F].from==s.index(g)){options.skips[F].from=s.index(g);z=G}break}}}}if(z.is("fieldset")){$.ajax({url:options.validationUrl,type:"post",data:formEl.serialize(),headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},complete:function(H,I){},beforeSend:function(I,H){var J=g.find("input:file[required]");if(J.length>0){$.each(J,function(){if($(this).val()){H.data=H.data+"&"+$(this).attr("name")+"=1"}})}H.data=H.data+"&current_page="+s.index(g)},success:function(P){if(P!==null&&typeof P==="object"){g.find(".error-block").remove();g.find(".form-group").removeClass("has-error");$.each(P,function(S,R){var T=g.find("#"+S).closest(".form-group");if(T.length>0){E=true;T.addClass("has-error");var Q=$("<div>",{"class":"help-block error-block",html:R});T.append(Q)}})}if(!E){g.hide();var M=$(".steps");if(M.length>0){M.find(".step").eq(s.index(g)).removeClass("current");M.find(".step").eq(s.index(z)).prevAll().addClass("success");M.find(".step").eq(s.index(z)).addClass("current")}else{var H=$(".progress").first();var K=H.find(".progress-bar");var L=K.find(".percent");var N=K.find(".title");var J=K.data("titles");if(typeof J!=="undefined"){J=J.split(",");var I=J[s.index(z)];N.html(I)}var O=Math.round(100/s.length*s.index(z))+"%";L.text(O);K.width(O)}if(z.is("fieldset")){z.show();e=g}}formEl.trigger("nextStep");Utils.postMessage({scrollToTop:"container"})},error:function(){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger");formEl.hide();Utils.postMessage({scrollToTop:"container"})}})}};window.previousStep=function(){if(e.is("fieldset")){g=formEl.find("fieldset:visible");for(var G=0;G<options.skips.length;G++){if(s.index(g)==options.skips[G].to){e=s.eq(options.skips[G].from);break}}var K=$(".steps");if(K.length>0){K.find(".step").removeClass("success");K.find(".step").eq(s.index(g)).removeClass("current");K.find(".step").eq(s.index(e)).prevAll().addClass("success");K.find(".step").eq(s.index(e)).addClass("current")}else{var E=$(".progress").first();var I=E.find(".progress-bar");var J=I.find(".percent");var L=I.find(".title");var H=I.data("titles");if(typeof H!=="undefined"){H=H.split(",");var F=H[s.index(e)];L.html(F)}var M=Math.round(100/s.length*s.index(e))+"%";J.text(M);I.width(M)}g.hide();e.show();e=e.prev();formEl.trigger("previousStep");Utils.postMessage({scrollToTop:"container"})}};$("input").on("keypress",function(F){if(F.keyCode==13){var E=$(F.currentTarget).parents("fieldset").find(".next");if(E.length>0){F.preventDefault();E.click();return false}}});$(".next").click(nextStep);$(".prev").click(previousStep);formEl.ajaxForm({url:options.actionUrl,type:"post",dataType:"json",beforeSend:function(E){if(o){E.setRequestHeader("fp",o)}if(l&&D){E.setRequestHeader("lat",l);E.setRequestHeader("lng",D)}},beforeSubmit:function(I,G,H){if(options.mode==="preview"){return false}var F=false;$.each(G.find('input[type="file"]'),function(J,K){if($(K).val()){F=true}});if(F){v.show();var E="0%";h.css("width",E);c.html(E+" "+options.i18n.complete)}formEl.find(":submit").attr("disabled",true);formEl.trigger("beforeSubmit")},uploadProgress:function(I,E,H,G){var F=G+"%";h.css("width",F);c.html(F+" "+options.i18n.complete)},success:function(E){if(E.success){j();x(E)}else{n(E)}},error:function(E,G,F){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger");formEl.hide();Utils.postMessage({scrollToTop:"container"})}});function q(){$(".error-block").remove();$(".form-group").removeClass("has-error")}function j(){q();formEl.find(":submit").attr("disabled",false);if(!(options.submissionData&&options.fields)){formEl.resetForm()}v.hide()}function x(U){options.submitted=true;var I=(new Date()).getTime();var E=I-t;formEl.trigger("success",[U,E]);if(s.length>1){var Q=$(".steps");if(Q.length>0){Q.find(".step").addClass("success")}else{var K=$(".progress").first();var O=K.find(".progress-bar");var G=O.find(".percent");var V=O.find(".title");V.html("Complete");G.text("100%");O.width("100%")}}if(typeof U.addon!=="undefined"){if(typeof U.addon.redirectTo!=="undefined"){var J=U.addon.redirectTo;if(window.location!==window.parent.location){Utils.postMessage({url:J})}else{window.location.href=J?J:"/"}}}var P=typeof U.confirmationType==="undefined"?options.confirmationType:U.confirmationType;var R=typeof U.message==="undefined"?options.confirmationMessage:U.message;var F=typeof U.confirmationUrl==="undefined"?options.confirmationUrl:U.confirmationUrl;var L=typeof U.confirmationSeconds==="undefined"?options.confirmationSeconds:U.confirmationSeconds;var T=typeof U.redirectToUrl==="undefined"?options.redirectToUrl:U.redirectToUrl;var H=typeof U.showOnlyMessage==="undefined"?options.showOnlyMessage:U.showOnlyMessage;var S=function(){if(window.location!==window.parent.location){Utils.postMessage({url:F})}else{window.location.href=F?F:"/"}};var M=function(){Utils.hideMessage("#messages");Utils.showMessage("#messages",R,"success");if(P===H){formEl.hide()}Utils.postMessage({scrollToTop:"container"})};if(P===T){var N=parseInt(L,10);if(N>0){M();setTimeout(function(){S()},N*1000)}else{S()}}else{M()}}function n(F){Utils.hideMessage("#messages");if(typeof F.message!=="undefined"){Utils.showMessage("#messages",F.message,"danger")}Utils.postMessage({scrollToTop:"container"});q();if(typeof F.errors!=="undefined"&&F.errors.length>0){var H=F.errors;for(k=0;k<H.length;k++){var G=$("#"+H[k].field).closest(".form-group");G.addClass("has-error");for(i=0;i<H[k].messages.length;i++){var E=$("<div>",{"class":"help-block error-block",html:H[k].messages[i]});G.append(E)}}}formEl.find(":submit").removeAttr("disabled");formEl.trigger("error",F)}function a(){if(options.mode==="preview"){return false}var F=$("canvas");if(F.length>0){for(var E=0;E<F.length;E++){(function(N){var P=new SignaturePad(N),O=P.canvas.id,K="#hidden_"+O,M="#clear_"+O,Q="#undo_"+O;var L=function(){var S=P.toData();if(S.length>0){var R={data:P.toData(),dataURL:P.toDataURL()};$(K).val(JSON.stringify(R))}else{$(K).val("")}$(K).trigger("change")};P.onEnd=function(){L()};var J=$("#"+O).data("color");if(J&&J.length>0&&J!=="black"){P.penColor=J}$(M).on("click",function(){P.clear();L()});$(Q).on("click",function(){var R=P.toData();if(R){R.pop();P.fromData(R);L()}});formEl.on("success",function(){P.clear();L()})})(F[E])}}var G=Utils.getUrlVars()["parentUrl"];G=G&&G.length>0?decodeURIComponent(G):window.location.href;if(G&&G.length>0){formEl.find(":input").each(function(){var K=$(this);var J=Utils.getUrlVars(G)[K.attr("id")];if(!J&&K.data("alias")&&K.data("alias").length>0){J=Utils.getUrlVars(G)[K.data("alias")]}if(K.attr("type")==="checkbox"||K.attr("type")==="radio"){if(J==="true"||J==="false"){K.prop("checked",(J==="true")).trigger("change")}}else{if(J){J=decodeURIComponent(J);K.val(J).trigger("change")}}})}if(options.defaultValues){options.defaultValues=JSON.parse(options.defaultValues);$.each(options.defaultValues,function(M,K){var J=M.split("_",1).shift();var L=$("#"+M);if(J==="checkbox"||J==="radio"){L.prop("checked",K).trigger("change")}else{L.val(K).trigger("change")}})}if(options.submissionData&&options.fields){var I=JSON.parse(options.submissionData);var H=$.map(options.fields,function(K,J){return K.name});$.each(H,function(N,R){var L=R.split("_",1);var J=L[0];if(J==="selectlist"){var M=I[R];$('select[name="'+R+'[]"] option:selected').prop("selected",false);$('select[name="'+R+'[]"]').each(function(){var S=$(this);if(typeof M==="string"){$('select[name="'+R+'[]"] option[value="'+M+'"]').prop("selected",true)}else{if(Array.isArray(M)){$.each(M,function(T,U){$('select[name="'+R+'[]"] option[value="'+U+'"]').prop("selected",true)})}}})}else{if(J==="checkbox"){var K=I[R];$('input[name="'+R+'[]"]').prop("checked",false).each(function(){var S=$(this);if(typeof K!=="undefined"){$.each(K,function(T,U){if(S.val()===U){S.prop("checked",true)}})}})}else{if(J==="radio"){$('input[name="'+R+'"]').each(function(S,U){var T=$(U);if(T.val()===I[R]){T.prop("checked",true)}})}else{if(J==="matrix"){var P=$("#"+R);if(P.length===0||(P.not("input")&&!P.is("select")&&!P.is("textarea"))){P=$('input[name="'+R+'"]');if(P.length===0){P=$('input[name="'+R+'[]"]')}}if(P.is("select")){var M=I[R];$('select[name="'+R+'[]"] option:selected').prop("selected",false);$('select[name="'+R+'[]"]').each(function(){var S=$(this);if(typeof M==="string"){$('select[name="'+R+'[]"] option[value="'+M+'"]').prop("selected",true)}else{if(Array.isArray(M)){$.each(M,function(T,U){$('select[name="'+R+'[]"] option[value="'+U+'"]').prop("selected",true)})}}})}else{if(P.is(":radio")){P.each(function(S,U){var T=$(U);if(T.val()===I[R]){T.prop("checked",true)}})}else{if(P.is(":checkbox")){var K=I[R];$('input[name="'+R+'[]"]').prop("checked",false).each(function(){var S=$(this);$.each(K,function(T,U){if(S.val()===U){S.prop("checked",true)}})})}else{P.val(I[R])}}}}else{if(R.substring(0,16)==="hidden_signature"){var Q=$("#"+R).closest("div").find("canvas");if(Q.length>0){for(var O=0;O<Q.length;O++){(function(S){var Y=new SignaturePad(S);if(typeof I[R]!=="undefined"&&I[R]){var T=JSON.parse(I[R]);Y.fromData(T.data)}var W=Y.canvas.id;var Z="#hidden_"+W;var V="#clear_"+W;var aa="#undo_"+W;var U=function(){var ab={data:Y.toData(),dataURL:Y.toDataURL()};$(Z).val(JSON.stringify(ab));$(Z).trigger("change")};$(Z).val(I[R]);Y.onEnd=function(){U()};var X=$("#"+W).data("color");if(X&&X.length>0&&X!=="black"){Y.penColor=X}$(V).on("click",function(){Y.clear();$(Z).val("")});$(aa).on("click",function(){var ab=Y.toData();if(Array.isArray(ab)&&ab.length){ab.pop();Y.fromData(ab);U()}})})(Q[O])}}}else{$("#"+R).val(I[R])}}}}}})}formEl.find(":input").each(function(){$(this).one("change",function(){if(A===false){if(options.mode==="preview"){return false}t=(new Date()).getTime();formEl.trigger("fill")}A=true})})}formEl.on("view",function(E){Utils.postMessage({action:"view"})});formEl.on("fill",function(E){Utils.postMessage({action:"fill"})});formEl.on("nextStep",function(E){Utils.postMessage({action:"nextStep"})});formEl.on("previousStep",function(E){Utils.postMessage({action:"previousStep"})});formEl.on("beforeSubmit",function(){Utils.postMessage({action:"beforeSubmit"})});formEl.on("error",function(E,F){Utils.postMessage({action:"error",data:F})});formEl.on("success",function(E,G,F){Utils.postMessage({action:"success",data:G,completionTime:F})});if(options.analytics){(function(I,F,J,E,G,K,H){if(!I[G]){I.FA=I.FA||[];I.FA.push(G);I[G]=function(){(I[G].q=I[G].q||[]).push(arguments)};I[G].q=I[G].q||[];K=F.createElement(J);H=F.getElementsByTagName(J)[0];K.async=1;K.src=E;H.parentNode.insertBefore(K,H)}}(window,document,"script",options.tracker,"tracker"));window.tracker("newTracker","t"+options.id,options.app,{encodeBase64:false,appId:options.id});formEl.on("view",function(E){window.tracker("setCustomUrl",decodeURIComponent(Utils.getUrlVars()["url"]));window.tracker("setReferrerUrl",decodeURIComponent(Utils.getUrlVars()["referrer"]));window.tracker("trackPageView",decodeURIComponent(Utils.getUrlVars()["title"]))});formEl.on("fill",function(E){window.tracker("trackStructEvent","form","fill","start",null,null)});formEl.on("error",function(E){window.tracker("trackStructEvent","form","error",null,null,null)});formEl.on("success",function(E,G,F){window.tracker("trackStructEvent","form","submit",G.id,"time",F)})}a();formEl.trigger("view")});