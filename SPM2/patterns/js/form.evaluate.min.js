(function(e){e.fn.evaluate=function(l,n){n=e.extend({},e.evaluate.defaults(),n||{});var m=new g(this,n);if(typeof l==="string"){m.formula(l)}else{l.bind(this).call(l,m)}return this};e.evaluate={inputParser:function(l){return l},outputFormatter:function(l){return l},options:function(l){if(l.inputParser){this.inputParser=l.inputParser}if(l.outputFormatter){this.outputFormatter=l.outputFormatter}},defaults:function(){return{inputParser:this.inputParser,outputFormatter:this.outputFormatter}}};if(typeof math["import"]!=="undefined"){if(typeof dateFns!=="undefined"){math["import"](dateFns,{wrap:true,silent:true});math["import"]({now:function(){return new Date()}})}}function g(m,l){this.base=e(m);this.details=null;this.opts=l||{};this.events=[]}g.prototype={formula:function(l){k.compile(this,l);k.updateEvents(this);this.run()},run:function(){var l=this;this.base.each(function(){l.runOne(e(this))})},runOne:function(o){var m=b(this.details.operands,o,this.opts.inputParser);var l=this.compiled.evaluate(m);var n=this.opts.outputFormatter(l);o.find(this.details.resultSelector).val(n)}};var k={compile:function(m,n){m.details=f(n);var l=math.parse(m.details.rside);m.compiled=l.compile(math)},updateEvents:function(l){k.removeEvents(l);k.setEvents(l)},removeEvents:function(l){l.events.forEach(function(m){m.query.off(m.name,m.handler)});l.events=[]},setEvents:function(l){Object.keys(l.details.operands).forEach(function(m){l.base.each(function(){var n=e(this);var o=n.find(m);k.setEvent(l,o,"change",function(){l.runOne(n)})})})},setEvent:function(m,p,n,o){var l={query:p,name:n,handler:o};l.query.on(l.name,l.handler);m.events.push(l)}};function f(m){var n={operands:{}};var l=m.match(/^\s*([^=\s]+)\s*=\s*(.*)$/);n.rside=c(l[2],n.operands);n.resultSelector=a(l[1]);return n}var h="{{([^}]+)}}";function c(n,m){var l=new RegExp(h,"g");return n.replace(l,function(p,o){var q=m[o];if(q){return q}return m[o]=i()})}function a(m){var l=new RegExp(h);return l.exec(m)[1]}var d=0;function i(l){return"X"+(d++)}function b(m,n,o){var l={};var p=e(n);e.each(j(m),function(){var q=this[0],s=this[1],r=p.find(q);l[s]=r.toArray().reduce(function(u,t){var v=e(t).val(),w=u+o(v)*1;if(Number.isNaN(w)){if(typeof v==="string"){w=v}}return w},0)});return l}function j(m){var l=[];Object.keys(m).forEach(function(n){l.push([n,m[n]])});return l}})(jQuery);